<UserControl x:Class="JouleadAssistantDesign.Views.ProjectConfigView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:JouleadAssistantDesign.ViewModels"
             MinHeight="400" MinWidth="600">
    <UserControl.DataContext>
        <vm:ProjectConfigViewModel/>
    </UserControl.DataContext>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 项目名称 -->
            <RowDefinition Height="Auto"/>
            <!-- 标题 -->
            <RowDefinition Height="*"/>
            <!-- 卡片区 -->
            <RowDefinition Height="Auto"/>
            <!-- 按钮 -->
        </Grid.RowDefinitions>

        <!-- 原有标题，改为 Grid.Row=1 -->
        <TextBlock Grid.Row="1"
               Text="请选择本项目所需的自定义项"
               FontSize="18" FontWeight="Bold"
               Margin="0,0,0,12"/>
        <!-- 新增：显示当前项目名称 -->
        <TextBlock Grid.Row="0"
               Text="{Binding ProjectName}"
               FontSize="20"
               FontWeight="Bold"
               Margin="0,0,0,8"/>
        <!-- 中间卡片区域 -->
        <ScrollViewer Grid.Row="2">
            <ItemsControl ItemsSource="{Binding CustomItems}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <!-- 4 列 4 行 -->
                        <UniformGrid Columns="4" Rows="4"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="4" Padding="8"
                Background="#FF007ACC" CornerRadius="4">
                            <!-- 在 Border 上通过 MouseBinding 触发命令 -->
                            <Border.InputBindings>
                                <MouseBinding Gesture="LeftClick"
                          Command="{Binding DataContext.SelectCustomItemCommand,
                                    RelativeSource={RelativeSource AncestorType=UserControl}}"
                          CommandParameter="{Binding Id}"/>
                            </Border.InputBindings>

                            <!-- 复选框依旧双向绑定 IsSelected -->
                            <CheckBox Content="{Binding Name}"
                    IsChecked="{Binding IsSelected, Mode=TwoWay}"
                    Foreground="White"
                    FontSize="14"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"/>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>


        <!-- 底部操作按钮 -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="编辑模板" Width="100" Margin="4"
          Command="{Binding EditTemplateCommand}"/>
            <Button Content="保存" Width="80" Margin="4"
          Command="{Binding SaveCommand}"/>

            <!-- 直接调用最外层 Window 的 ShowProjectListCommand -->
            <Button Content="返回" Width="80" Margin="4"
          Command="{Binding DataContext.ShowProjectListCommand,
                    RelativeSource={RelativeSource AncestorType=Window}}"/>
        </StackPanel>
    </Grid>
</UserControl>

